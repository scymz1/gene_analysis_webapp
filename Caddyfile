phenoprofiler.org {
    tls {
        issuer acme
    }

    # Allow Let's Encrypt HTTP challenge
    handle /.well-known/acme-challenge/* {
        root * /var/www/html
        file_server
    }

    # Reverse proxy for Next.js frontend
    handle /* {
        reverse_proxy localhost:3000 {
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote_host}
            header_up X-Real-IP {remote_host}
        }
    }

    # Reverse proxy for Django backend
    handle /phenoProfiler/* {
        reverse_proxy localhost:8000 {
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote_host}
            header_up X-Real-IP {remote_host}
        }
    }
}